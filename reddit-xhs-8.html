<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit2XHS Pro - åŠ¨æ€åˆ·æ–°ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

        :root {
            --primary: #FF2442;
            --text-main: #1D1D1F;
            --text-sub: #515154;
            --card-w: 375px;
            --card-h: 500px;
            --bg-q: linear-gradient(180deg, #FFF3F4 0%, #FFFFFF 100%);
            --bg-a: linear-gradient(180deg, #F0F5FF 0%, #FFFFFF 100%);
            --bg-v: linear-gradient(180deg, #F9F9F9 0%, #F1F1F1 100%);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Outfit', 'Noto Sans SC', sans-serif;
            background: #0D0D0D;
            display: flex;
            height: 100vh;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* é¢æ¿æ ·å¼ */
        .panel {
            width: 360px;
            background: #181818;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #2A2A2A;
            color: #E0E0E0;
        }

        h2 {
            font-size: 18px;
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 1px;
        }

        .label {
            font-size: 11px;
            color: #777;
            font-weight: 700;
            text-transform: uppercase;
            margin: 12px 0 6px;
            display: block;
        }

        .edit-block {
            background: #222;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid #333;
        }

        select,
        input,
        textarea {
            width: 100%;
            padding: 10px;
            background: #2D2D2D;
            border: 1px solid #444;
            border-radius: 6px;
            color: #fff;
            font-family: inherit;
            font-size: 13px;
            outline: none;
        }

        button {
            cursor: pointer;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            width: 100%;
            margin-top: 8px;
            transition: 0.2s;
        }

        .btn-fetch {
            background: var(--primary);
            color: white;
        }

        .btn-download {
            background: #FFF;
            color: #000;
            margin-top: 20px;
        }

        /* é¢„è§ˆåŒº */
        .preview {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            background: #050505;
        }

        /* å¡ç‰‡è®¾è®¡ */
        .xhs-card {
            width: var(--card-w);
            height: var(--card-h);
            position: relative;
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            border-radius: 36px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
            flex-shrink: 0;
            background-image: radial-gradient(rgba(0, 0, 0, 0.02) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .category-tag {
            background: var(--text-main);
            color: #fff;
            font-weight: 600;
            font-size: 9px;
            letter-spacing: 2px;
            padding: 4px 12px;
            border-radius: 100px;
            width: fit-content;
            margin-bottom: 24px;
        }

        .title-en {
            font-size: 22px;
            font-weight: 600;
            line-height: 1.3;
            color: var(--text-main);
            letter-spacing: -0.2px;
        }

        .ans-en {
            font-size: 16px;
            font-weight: 500;
            line-height: 1.5;
            color: var(--text-main);
        }

        .trans-wrapper {
            margin-top: 20px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            border: 1px solid rgba(0, 0, 0, 0.04);
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.02);
        }

        .trans-wrapper::before {
            content: "";
            position: absolute;
            left: 0;
            top: 16px;
            bottom: 16px;
            width: 3px;
            background: var(--primary);
            border-radius: 0 4px 4px 0;
        }

        .title-cn,
        .ans-cn {
            font-size: 14.5px;
            color: var(--text-sub);
            line-height: 1.6;
            font-weight: 400;
            padding-left: 8px;
        }

        .highlight {
            background: rgba(255, 36, 66, 0.07);
            color: var(--primary);
            padding: 0 2px;
            border-bottom: 1.5px solid var(--primary);
            font-weight: 600;
        }

        .vocab-row {
            display: flex;
            align-items: center;
            background: #fff;
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 10px;
            border-bottom: 1px solid #F0F0F0;
        }

        .v-word {
            font-weight: 600;
            color: var(--primary);
            font-size: 15px;
            width: 40%;
        }

        .v-mean {
            font-weight: 400;
            color: var(--text-sub);
            font-size: 13.5px;
            flex: 1;
            text-align: right;
        }

        .footer {
            margin-top: auto;
            font-size: 10px;
            color: #A1A1A6;
            text-align: center;
            font-weight: 500;
            letter-spacing: 1.5px;
        }

        #loader {
            display: none;
            text-align: center;
            color: var(--primary);
            font-size: 12px;
            margin: 10px 0;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div class="panel">
        <h2>REDDIT2XHS ENGINE</h2>

        <label class="label">é€‰æ‹©é¢‘é“</label>
        <select id="sub-select">
            <option value="AskReddit">AskReddit (å…¨çƒé—®ç­”)</option>
            <option value="Showerthoughts">Showerthoughts (è„‘æ´)</option>
            <option value="LifeProTips">LifeProTips (ç”Ÿæ´»å¦™æ‹›)</option>
        </select>
        <button class="btn-fetch" onclick="fetchLiveReddit()">ğŸ“¡ è·å–ä»Šæ—¥æœ€çƒ­è¯é¢˜</button>
        <div id="loader">æ­£åœ¨ç»•è¿‡ç¼“å­˜è·å–æ–°é²œå†…å®¹...</div>

        <label class="label">æ‰‹åŠ¨ç¼–è¾‘å†…å®¹</label>
        <div id="editor-container"></div>

        <label class="label">è‡ªå®šä¹‰é¡µè„š</label>
        <input type="text" id="q-footer" value="@åšä¸»å | è·Ÿç€ Reddit çœ‹ä¸–ç•Œ" oninput="sync('qf', this.value)">
        <input type="text" id="a-footer" value="LIKE & FOLLOW FOR MORE" style="margin-top:5px"
            oninput="sync('af', this.value)">

        <label class="label">é‡ç‚¹è¯æ±‡åº“ (å•è¯-è§£æ)</label>
        <textarea id="vocab-input" rows="4" placeholder="stunning-æƒŠäººçš„" oninput="updateVocab(this.value)"></textarea>

        <button class="btn-download" onclick="exportImages()">ğŸ“¥ ä¸‹è½½ 3:4 ææ¸…å›¾é›†</button>
    </div>

    <div class="preview" id="preview-container"></div>

    <script>
        let contentData = {
            questionEn: "What's the best advice you've ever received?",
            questionCn: "ä½ å¬è¿‡æœ€å¥½çš„å»ºè®®æ˜¯ä»€ä¹ˆï¼Ÿ",
            answers: [{ en: "Don't set yourself on fire to keep others warm. It's truly eye-opening.", cn: "ä¸è¦ä¸ºäº†æ¸©æš–åˆ«äººè€Œç‚¹ç‡ƒè‡ªå·±ã€‚è¿™å¥è¯çœŸçš„è®©æˆ‘è±ç„¶å¼€æœ—ã€‚" }],
            qf: "@Rucy çš„ç¢ç¢å¿µ | è·Ÿç€ Reddit çœ‹ä¸–ç•Œ",
            af: "LIKE & FOLLOW FOR MORE"
        };
        let vocabList = [];

        // --- é‡ç‚¹æ”¹è¿›éƒ¨åˆ†ï¼šå¢åŠ éšæœºæ€§å’Œé˜²ç¼“å­˜ ---
        async function fetchLiveReddit() {
            const sub = document.getElementById('sub-select').value;
            const loader = document.getElementById('loader');
            loader.style.display = 'block';

            try {
                const proxyUrl = "https://corsproxy.io/?";
                // æ·»åŠ  _cb å‚æ•°ï¼ˆæ—¶é—´æˆ³ï¼‰é˜²æ­¢ç¼“å­˜ï¼Œlimit è®¾ç½®ä¸º 15 å¢åŠ æ ·æœ¬é‡
                const redditUrl = `https://www.reddit.com/r/${sub}/hot.json?limit=15&_cb=${Date.now()}`;

                const response = await fetch(proxyUrl + encodeURIComponent(redditUrl));
                const data = await response.json();

                // è¿‡æ»¤æ‰ç½®é¡¶è´´å’Œ NSFW
                const posts = data.data.children.filter(p => !p.data.over_18 && !p.data.stickied);
                if (posts.length === 0) throw new Error("æœªæ‰¾åˆ°å†…å®¹");

                // ã€æ ¸å¿ƒæ”¹åŠ¨ã€‘ä»å‰ 10 ä¸ªå¸–å­ä¸­éšæœºé€‰å–ä¸€ä¸ªï¼Œè€Œä¸æ˜¯å›ºå®šç¬¬ä¸€ä¸ª
                const randomIndex = Math.floor(Math.random() * Math.min(posts.length, 10));
                const post = posts[randomIndex].data;

                const commUrl = `https://www.reddit.com/r/${sub}/comments/${post.id}.json?limit=8&_cb=${Date.now()}`;
                const commRes = await fetch(proxyUrl + encodeURIComponent(commUrl));
                const commData = await commRes.json();

                const rawComments = (commData[1] && commData[1].data && commData[1].data.children) ? commData[1].data.children : [];
                // è¿‡æ»¤æ‰ AutoModerator æˆ–å¤ªçŸ­çš„è¯„è®ºï¼Œå¹¶éšæœºé€‰ 3 æ¡
                const validComments = rawComments
                    .filter(c => c.kind === 't1' && c.data.author !== 'AutoModerator' && c.data.body.length > 20)
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 3);

                contentData.questionEn = post.title;
                contentData.questionCn = "ï¼ˆè¯·ç¼–è¾‘æ ‡é¢˜ç¿»è¯‘ï¼‰";
                contentData.answers = validComments.map(c => ({
                    en: c.data.body.substring(0, 320).replace(/\n/g, ' '),
                    cn: "ï¼ˆè¯·ç¼–è¾‘å›å¤ç¿»è¯‘ï¼‰"
                }));

                renderEditor();
                renderCards();
            } catch (err) {
                console.error(err);
                alert("åˆ·æ–°å¤±è´¥ï¼Œè¯·ç¨åå†è¯•æˆ–æ›´æ¢é¢‘é“ã€‚");
            } finally {
                loader.style.display = 'none';
            }
        }

        // --- åŠŸèƒ½ä¿æŒéƒ¨åˆ† ---
        function renderEditor() {
            const container = document.getElementById('editor-container');
            let html = `<div class="edit-block"><label class="label">æ ‡é¢˜ç¿»è¯‘</label><input type="text" value="${contentData.questionCn}" oninput="sync('qCn', this.value)"></div>`;
            contentData.answers.forEach((ans, i) => {
                html += `<div class="edit-block"><label class="label">è¯„è®º ${i + 1}</label><textarea oninput="sync('aCn', this.value, ${i})">${ans.cn}</textarea></div>`;
            });
            container.innerHTML = html;
        }

        function sync(type, val, idx) {
            if (type === 'qCn') contentData.questionCn = val;
            if (type === 'aCn') contentData.answers[idx].cn = val;
            if (type === 'qf') contentData.qf = val;
            if (type === 'af') contentData.af = val;
            renderCards();
        }

        function updateVocab(val) {
            vocabList = val.split('\n').filter(line => line.includes('-')).map(line => {
                const [word, meaning] = line.split('-');
                return { word: word.trim(), meaning: meaning.trim() };
            });
            renderCards();
        }

        function highlightText(text) {
            let h = text;
            vocabList.forEach(item => {
                if (!item.word) return;
                const regex = new RegExp(`\\b${item.word}\\b`, 'gi');
                h = h.replace(regex, `<span class="highlight">$&</span>`);
            });
            return h;
        }

        function renderCards() {
            const container = document.getElementById('preview-container');
            container.innerHTML = "";

            // P1: Cover
            const qCard = document.createElement('div');
            qCard.className = 'xhs-card';
            qCard.style.background = "var(--bg-q)";
            qCard.innerHTML = `
            <div class="category-tag">RANDOM TRENDING</div>
            <div class="title-en">${contentData.questionEn}</div>
            <div class="trans-wrapper"><div class="title-cn">${contentData.questionCn}</div></div>
            <div class="footer">${contentData.qf}</div>
        `;
            container.appendChild(qCard);

            // P2-4: Answers
            contentData.answers.forEach((ans, i) => {
                const aCard = document.createElement('div');
                aCard.className = 'xhs-card';
                aCard.style.background = "var(--bg-a)";
                aCard.innerHTML = `
                <div class="category-tag">TOP COMMENT #${i + 1}</div>
                <div class="ans-en">${highlightText(ans.en)}</div>
                <div class="trans-wrapper"><div class="ans-cn">${ans.cn}</div></div>
                <div class="footer">${contentData.af}</div>
            `;
                container.appendChild(aCard);
            });

            // P5: Summary
            if (vocabList.length > 0) {
                const vCard = document.createElement('div');
                vCard.className = 'xhs-card';
                vCard.style.background = "var(--bg-v)";
                let listHtml = vocabList.map(item => `<div class="vocab-row"><span class="v-word">${item.word}</span><span class="v-mean">${item.meaning}</span></div>`).join('');
                vCard.innerHTML = `
                <div class="category-tag" style="background:var(--primary)">VOCAB NOTES</div>
                <div style="margin-top:10px">${listHtml}</div>
                <div class="footer">#è‹±è¯­å­¦ä¹  #Redditç¬”è®°</div>
            `;
                container.appendChild(vCard);
            }
        }

        async function exportImages() {
            const cards = document.querySelectorAll('.xhs-card');
            for (let i = 0; i < cards.length; i++) {
                const canvas = await html2canvas(cards[i], { scale: 3, backgroundColor: null });
                const link = document.createElement('a');
                link.download = `Reddit_New_0${i + 1}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
            }
        }

        renderEditor();
        renderCards();
    </script>
</body>

</html>